--[[
    ðŸ BEE COMMANDER â€” Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ñ‡Ñ‘Ð»Ð°Ð¼Ð¸
    - P: Ð¿Ñ€Ð¸Ñ‚ÑÐ½ÑƒÑ‚ÑŒ Ð²ÑÐµÑ… Ð¿Ñ‡Ñ‘Ð» Ðº ÑÐµÐ±Ðµ
    - M: Ð°Ñ‚Ð°ÐºÐ¾Ð²Ð°Ñ‚ÑŒ Ð±Ð»Ð¸Ð¶Ð°Ð¹ÑˆÐµÐ³Ð¾ Ð¼Ð¾Ð±Ð°
    - ÐœÐµÐ½ÑŽ: Ð°Ð²Ñ‚Ð¾ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ð½Ð¸Ðµ, Ð¿Ð¾Ð´ÑÐ²ÐµÑ‚ÐºÐ°, Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸
]]

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = (gethui and gethui()) or game:GetService("CoreGui")

if syn and syn.protect_gui then syn.protect_gui(CoreGui) elseif protect_gui then protect_gui(CoreGui) end

local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- ========== ÐÐÐ¡Ð¢Ð ÐžÐ™ÐšÐ˜ (Ð¼Ð¾Ð¶Ð½Ð¾ Ð¼ÐµÐ½ÑÑ‚ÑŒ Ñ‡ÐµÑ€ÐµÐ· Ð¼ÐµÐ½ÑŽ) ==========
local Settings = {
    AutoAttract = false,        -- Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¿Ñ€Ð¸Ñ‚ÑÐ³Ð¸Ð²Ð°Ñ‚ÑŒ Ð¿Ñ‡Ñ‘Ð»
    BeeHighlight = true,         -- Ð¿Ð¾Ð´ÑÐ²ÐµÑ‡Ð¸Ð²Ð°Ñ‚ÑŒ Ð¿Ñ‡Ñ‘Ð» ÑÐ¸Ð½Ð¸Ð¼
    AttractKey = Enum.KeyCode.P,
    AttackKey = Enum.KeyCode.M,
    BeeFolderPath = "workspace.Bees",  -- Ð¿ÑƒÑ‚ÑŒ Ðº Ð¿Ð°Ð¿ÐºÐµ Ñ Ð¿Ñ‡Ñ‘Ð»Ð°Ð¼Ð¸ (Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ)
}

-- ========== ÐŸÐ•Ð Ð•ÐœÐ•ÐÐÐ«Ð• ==========
local Bees = {}                  -- ÑÐ¿Ð¸ÑÐ¾Ðº Ð¿Ñ‡Ñ‘Ð» Ð¸Ð³Ñ€Ð¾ÐºÐ°
local HighlightFolder = Instance.new("Folder")
HighlightFolder.Name = "BeeHighlights"
HighlightFolder.Parent = CoreGui

-- ========== Ð¤Ð£ÐÐšÐ¦Ð˜Ð¯ ÐŸÐžÐ›Ð£Ð§Ð•ÐÐ˜Ð¯ ÐŸÐÐŸÐšÐ˜ ÐŸÐž ÐŸÐ£Ð¢Ð˜ ==========
local function getFolderFromPath(path)
    local success, result = pcall(function()
        return loadstring("return " .. path)()
    end)
    if success and result then
        return result
    end
    return nil
end

-- ========== ÐŸÐžÐ˜Ð¡Ðš ÐŸÐ§ÐÐ› Ð˜Ð“Ð ÐžÐšÐ ==========
local function FindMyBees()
    local beeFolder = getFolderFromPath(Settings.BeeFolderPath)
    if not beeFolder then
        -- Ð•ÑÐ»Ð¸ Ð¿ÑƒÑ‚ÑŒ Ð½ÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹, Ð¿Ñ€Ð¾Ð±ÑƒÐµÐ¼ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ñ‹Ðµ Ð¼ÐµÑÑ‚Ð°
        beeFolder = workspace:FindFirstChild("Bees") or workspace:FindFirstChild("BeeFolder")
    end
    if not beeFolder then return {} end

    local myBees = {}
    -- Ð’ Bee Swarm Ð¿Ñ‡Ñ‘Ð»Ñ‹ Ð¾Ð±Ñ‹Ñ‡Ð½Ð¾ Ð¼Ð¾Ð´ÐµÐ»Ð¸ Ñ Ð¸Ð¼ÐµÐ½ÐµÐ¼ "Bee" Ð¸Ð»Ð¸ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‰Ð¸Ð¼ "Bee"
    for _, obj in pairs(beeFolder:GetChildren()) do
        if obj:IsA("Model") and obj.Name:find("Bee") then
            -- ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, Ð¿Ñ€Ð¸Ð½Ð°Ð´Ð»ÐµÐ¶Ð¸Ñ‚ Ð»Ð¸ Ð¿Ñ‡ÐµÐ»Ð° Ð¸Ð³Ñ€Ð¾ÐºÑƒ (Ñ‡Ð°ÑÑ‚Ð¾ ÐµÑÑ‚ÑŒ Ð°Ñ‚Ñ€Ð¸Ð±ÑƒÑ‚ "Owner")
            local owner = obj:GetAttribute("Owner")
            if owner == LocalPlayer.UserId then
                table.insert(myBees, obj)
            elseif obj.Parent and obj.Parent.Name == LocalPlayer.Name then
                table.insert(myBees, obj)
            end
        end
    end
    return myBees
end

-- ========== ÐžÐ‘ÐÐžÐ’Ð›Ð•ÐÐ˜Ð• Ð¡ÐŸÐ˜Ð¡ÐšÐ ÐŸÐ§ÐÐ› ==========
local function UpdateBees()
    Bees = FindMyBees()
end

-- ========== ÐŸÐ Ð˜Ð¢Ð¯ÐÐ£Ð¢Ð¬ Ð’Ð¡Ð•Ð¥ ÐŸÐ§ÐÐ› ==========
local function AttractBees()
    local char = LocalPlayer.Character
    if not char then return end
    local root = char:FindFirstChild("HumanoidRootPart") or char:FindFirstChild("Torso")
    if not root then return end

    for _, bee in ipairs(Bees) do
        if bee and bee.PrimaryPart then
            bee:SetPrimaryPartCFrame(CFrame.new(root.Position + Vector3.new(0, 5, 0)))
        end
    end
    print("ðŸ ÐŸÑ‡Ñ‘Ð»Ñ‹ Ð¿Ñ€Ð¸Ñ‚ÑÐ½ÑƒÑ‚Ñ‹!")
end

-- ========== ÐÐ¢ÐÐšÐ Ð‘Ð›Ð˜Ð–ÐÐ™Ð¨Ð•Ð“Ðž ÐœÐžÐ‘Ð ==========
local function AttackNearestMob()
    local char = LocalPlayer.Character
    if not char then return end
    local root = char:FindFirstChild("HumanoidRootPart") or char:FindFirstChild("Torso")
    if not root then return end

    -- ÐŸÐ¾Ð¸ÑÐº Ð±Ð»Ð¸Ð¶Ð°Ð¹ÑˆÐµÐ³Ð¾ Ð¼Ð¾Ð±Ð° (Ð¾Ð±ÑŠÐµÐºÑ‚ Ñ Humanoid, Ð½Ðµ Ð¸Ð³Ñ€Ð¾Ðº)
    local nearestMob = nil
    local minDist = math.huge
    for _, obj in pairs(workspace:GetDescendants()) do
        if obj:IsA("Model") and obj:FindFirstChild("Humanoid") then
            local hum = obj:FindFirstChild("Humanoid")
            if hum and hum.Health > 0 and not Players:GetPlayerFromCharacter(obj) then
                local mobRoot = obj:FindFirstChild("HumanoidRootPart") or obj:FindFirstChild("Torso")
                if mobRoot then
                    local dist = (mobRoot.Position - root.Position).Magnitude
                    if dist < minDist then
                        minDist = dist
                        nearestMob = mobRoot
                    end
                end
            end
        end
    end

    if nearestMob then
        for _, bee in ipairs(Bees) do
            if bee and bee.PrimaryPart then
                bee:SetPrimaryPartCFrame(CFrame.new(nearestMob.Position))
            end
        end
        print("ðŸ ÐŸÑ‡Ñ‘Ð»Ñ‹ Ð°Ñ‚Ð°ÐºÑƒÑŽÑ‚!")
    else
        print("âŒ ÐœÐ¾Ð± Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½")
    end
end

-- ========== ÐŸÐžÐ”Ð¡Ð’Ð•Ð¢ÐšÐ ÐŸÐ§ÐÐ› ==========
local function UpdateHighlights()
    -- Ð£Ð´Ð°Ð»ÑÐµÐ¼ ÑÑ‚Ð°Ñ€Ñ‹Ðµ
    for _, child in pairs(HighlightFolder:GetChildren()) do
        child:Destroy()
    end

    if Settings.BeeHighlight then
        for _, bee in ipairs(Bees) do
            if bee then
                local hl = Instance.new("Highlight")
                hl.Adornee = bee
                hl.FillColor = Color3.fromRGB(0, 100, 255)
                hl.FillTransparency = 0.5
                hl.OutlineColor = Color3.fromRGB(255, 255, 255)
                hl.OutlineTransparency = 0
                hl.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
                hl.Parent = HighlightFolder
            end
        end
    end
end

-- ========== Ð“Ð›ÐÐ’ÐÐ«Ð™ Ð¦Ð˜ÐšÐ› ==========
RunService.Heartbeat:Connect(function()
    UpdateBees()
    UpdateHighlights()

    if Settings.AutoAttract then
        AttractBees()
    end
end)

-- ========== Ð£ÐŸÐ ÐÐ’Ð›Ð•ÐÐ˜Ð• ÐšÐ›ÐÐ’Ð˜Ð¨ÐÐœÐ˜ ==========
UserInputService.InputBegan:Connect(function(input, gp)
    if gp then return end
    if input.KeyCode == Settings.AttractKey then
        AttractBees()
    elseif input.KeyCode == Settings.AttackKey then
        AttackNearestMob()
    end
end)

-- ========== ÐœÐ•ÐÐ® (DRAWING) ==========
local function CreateMenu()
    local bg = Drawing.new("Square")
    bg.Visible = true
    bg.Color = Color3.fromRGB(30, 30, 40)
    bg.Transparency = 0.9
    bg.Size = Vector2.new(300, 250)
    bg.Position = Vector2.new(50, 50)
    bg.Filled = true
    bg.ZIndex = 999

    local title = Drawing.new("Text")
    title.Visible = true
    title.Color = Color3.fromRGB(255, 255, 0)
    title.Position = Vector2.new(60, 55)
    title.Text = "ðŸ BEE COMMANDER"
    title.Size = 18
    title.ZIndex = 1000

    local closeBtn = Drawing.new("Text")
    closeBtn.Visible = true
    closeBtn.Color = Color3.new(1,0,0)
    closeBtn.Position = Vector2.new(330, 55)
    closeBtn.Text = "X"
    closeBtn.Size = 18
    closeBtn.ZIndex = 1000

    local items = {}
    local yPos = 85

    local function AddCheckbox(text, getter, setter)
        local box = Drawing.new("Square")
        box.Visible = true
        box.Color = getter() and Color3.fromRGB(0,255,0) or Color3.fromRGB(80,80,80)
        box.Size = Vector2.new(12,12)
        box.Position = Vector2.new(60, yPos)
        box.Filled = true
        box.ZIndex = 1000

        local lbl = Drawing.new("Text")
        lbl.Visible = true
        lbl.Color = Color3.new(1,1,1)
        lbl.Position = Vector2.new(80, yPos-2)
        lbl.Text = text
        lbl.Size = 14
        lbl.ZIndex = 1000

        table.insert(items, {box=box, lbl=lbl, y=yPos, set=setter, get=getter})
        yPos = yPos + 25
    end

    AddCheckbox("ÐÐ²Ñ‚Ð¾-Ð¿Ñ€Ð¸Ñ‚ÑÐ³Ð¸Ð²Ð°Ð½Ð¸Ðµ", 
        function() return Settings.AutoAttract end,
        function(v) Settings.AutoAttract = v end)

    AddCheckbox("ÐŸÐ¾Ð´ÑÐ²ÐµÑ‚ÐºÐ° Ð¿Ñ‡Ñ‘Ð»", 
        function() return Settings.BeeHighlight end,
        function(v) Settings.BeeHighlight = v end)

    -- ÐŸÐ¾Ð»Ðµ Ð´Ð»Ñ Ð²Ð²Ð¾Ð´Ð° Ð¿ÑƒÑ‚Ð¸ (ÑƒÐ¿Ñ€Ð¾Ñ‰Ñ‘Ð½Ð½Ð¾ â€“ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ Ñ‚ÐµÐºÑƒÑ‰Ð¸Ð¹)
    local pathText = Drawing.new("Text")
    pathText.Visible = true
    pathText.Color = Color3.new(1,1,1)
    pathText.Position = Vector2.new(60, yPos)
    pathText.Text = "ÐŸÑƒÑ‚ÑŒ Ðº Ð¿Ñ‡Ñ‘Ð»Ð°Ð¼:"
    pathText.Size = 14
    pathText.ZIndex = 1000
    yPos = yPos + 20

    local pathValue = Drawing.new("Text")
    pathValue.Visible = true
    pathValue.Color = Color3.fromRGB(100,255,100)
    pathValue.Position = Vector2.new(60, yPos)
    pathValue.Text = Settings.BeeFolderPath
    pathValue.Size = 14
    pathValue.ZIndex = 1000
    yPos = yPos + 25

    local info1 = Drawing.new("Text")
    info1.Visible = true
    info1.Color = Color3.new(1,1,1)
    info1.Position = Vector2.new(60, yPos)
    info1.Text = "P - Ð¿Ñ€Ð¸Ñ‚ÑÐ½ÑƒÑ‚ÑŒ | M - Ð°Ñ‚Ð°ÐºÐ°"
    info1.Size = 14
    info1.ZIndex = 1000
    yPos = yPos + 20

    local info2 = Drawing.new("Text")
    info2.Visible = true
    info2.Color = Color3.new(1,1,1)
    info2.Position = Vector2.new(60, yPos)
    info2.Text = "ÐÐ°Ð¹Ð´ÐµÐ½Ð¾ Ð¿Ñ‡Ñ‘Ð»: " .. #Bees
    info2.Size = 14
    info2.ZIndex = 1000

    -- ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° ÐºÐ»Ð¸ÐºÐ¾Ð²
    UserInputService.InputBegan:Connect(function(input, gp)
        if gp then return end
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            local m = UserInputService:GetMouseLocation()
            if m.X >= 50 and m.X <= 350 and m.Y >= 50 and m.Y <= 300 then
                for _, item in ipairs(items) do
                    if m.X >= 60 and m.X <= 72 and m.Y >= item.y-6 and m.Y <= item.y+6 then
                        local new = not item.get()
                        item.set(new)
                        item.box.Color = new and Color3.fromRGB(0,255,0) or Color3.fromRGB(80,80,80)
                    end
                end
            end
            if m.X >= 330 and m.X <= 350 and m.Y >= 55 and m.Y <= 73 then
                -- Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¼ÐµÐ½ÑŽ
                bg.Visible = false
                title.Visible = false
                closeBtn.Visible = false
                pathText.Visible = false
                pathValue.Visible = false
                info1.Visible = false
                info2.Visible = false
                for _, item in ipairs(items) do
                    item.box.Visible = false
                    item.lbl.Visible = false
                end
                HighlightFolder:Destroy()
            end
        end
    end)

    -- ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ ÑÑ‡Ñ‘Ñ‚Ñ‡Ð¸Ðº Ð¿Ñ‡Ñ‘Ð»
    RunService.RenderStepped:Connect(function()
        info2.Text = "ÐÐ°Ð¹Ð´ÐµÐ½Ð¾ Ð¿Ñ‡Ñ‘Ð»: " .. #Bees
    end)
end

-- ========== Ð—ÐÐŸÐ£Ð¡Ðš ==========
CreateMenu()
print("âœ… Bee Commander Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½. ÐœÐµÐ½ÑŽ ÑÐ»ÐµÐ²Ð° Ð²Ð²ÐµÑ€Ñ…Ñƒ. P - Ð¿Ñ€Ð¸Ñ‚ÑÐ½ÑƒÑ‚ÑŒ, M - Ð°Ñ‚Ð°ÐºÐ°.")
