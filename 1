--[[
    ğŸ”¸ ESP + FLY (Ğ¾Ğ±ÑŠĞµĞ´Ğ¸Ğ½Ñ‘Ğ½Ğ½Ñ‹Ğ¹ ÑĞºÑ€Ğ¸Ğ¿Ñ‚)
    - ESP: Ğ¶Ñ‘Ğ»Ñ‚Ñ‹Ğµ Ñ€Ğ°Ğ¼ĞºĞ¸ Ğ½Ğ° Ğ²ÑĞµ Ñ‡Ğ°ÑÑ‚Ğ¸ Ğ²Ñ€Ğ°Ğ³Ğ¾Ğ² (Ğ½Ğ°ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ TeamCheck)
    - Fly: Ğ¿Ğ¾Ğ»Ñ‘Ñ‚ Ñ BodyVelocity, Ğ°ĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ ĞºĞ»Ğ°Ğ²Ğ¸ÑˆĞµ F
    - Ğ‘ĞµĞ· Ğ»Ğ¸ÑˆĞ½ĞµĞ³Ğ¾ GUI, Ğ²ÑÑ‘ Ğ² ĞºĞ¾Ğ´Ğµ
]]

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = (gethui and gethui()) or game:GetService("CoreGui")

if syn and syn.protect_gui then syn.protect_gui(CoreGui) elseif protect_gui then protect_gui(CoreGui) end

local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- ========== ĞĞĞ¡Ğ¢Ğ ĞĞ™ĞšĞ˜ ==========
local TeamCheck = true          -- true = Ğ¿Ğ¾Ğ´ÑĞ²ĞµÑ‡Ğ¸Ğ²Ğ°Ñ‚ÑŒ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ²Ñ€Ğ°Ğ³Ğ¾Ğ² (Ğ½Ğµ ÑĞ¾ÑĞ·Ğ½Ğ¸ĞºĞ¾Ğ²)
local FlySpeed = 50             -- ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ Ğ¿Ğ¾Ğ»Ñ‘Ñ‚Ğ°

-- ========== ESP ==========
local ESP_Folder = Instance.new("Folder")
ESP_Folder.Name = "ESP_Container"
ESP_Folder.Parent = CoreGui

local function IsEnemy(player)
    if player == LocalPlayer then return false end
    if TeamCheck then
        if not player.Team or not LocalPlayer.Team then return true end
        return player.Team ~= LocalPlayer.Team
    end
    return true
end

-- ========== FLY ==========
local flyEnabled = false
local flyBV = nil
local flyBG = nil
local flyConnection = nil

local function EnableFly()
    local char = LocalPlayer.Character
    if not char then return end
    local root = char:FindFirstChild("HumanoidRootPart")
    local hum = char:FindFirstChild("Humanoid")
    if not root or not hum then return end

    hum.PlatformStand = true

    flyBV = Instance.new("BodyVelocity")
    flyBV.Name = "FlyBV"
    flyBV.MaxForce = Vector3.new(9000, 9000, 9000)
    flyBV.Velocity = Vector3.new(0, 0, 0)
    flyBV.Parent = root

    flyBG = Instance.new("BodyGyro")
    flyBG.Name = "FlyBG"
    flyBG.MaxTorque = Vector3.new(9000, 9000, 9000)
    flyBG.P = 1000
    flyBG.D = 500
    flyBG.CFrame = root.CFrame
    flyBG.Parent = root

    flyEnabled = true
end

local function DisableFly()
    flyEnabled = false
    if flyBV then flyBV:Destroy() flyBV = nil end
    if flyBG then flyBG:Destroy() flyBG = nil end
    local char = LocalPlayer.Character
    if char then
        local hum = char:FindFirstChild("Humanoid")
        if hum then hum.PlatformStand = false end
    end
end

local function ToggleFly()
    if flyEnabled then
        DisableFly()
        print("ğŸ›‘ FLY OFF")
    else
        EnableFly()
        print("ğŸ•Šï¸ FLY ON")
    end
end

-- Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ»Ğ°Ğ²Ğ¸ÑˆĞµĞ¹ F
UserInputService.InputBegan:Connect(function(input, gp)
    if gp then return end
    if input.KeyCode == Enum.KeyCode.F then
        ToggleFly()
    end
end)

-- ĞÑ‚ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»Ñ‘Ñ‚Ğ° Ğ¿Ñ€Ğ¸ Ñ€ĞµÑĞ¿Ğ°Ğ²Ğ½Ğµ
LocalPlayer.CharacterAdded:Connect(function()
    if flyEnabled then
        DisableFly()
    end
end)

-- Ğ¦Ğ¸ĞºĞ» Ğ¿Ğ¾Ğ»Ñ‘Ñ‚Ğ° (ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ)
flyConnection = RunService.Heartbeat:Connect(function()
    if flyEnabled and LocalPlayer.Character then
        local root = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if root and flyBV and flyBG then
            local move = Vector3.new()
            if UserInputService:IsKeyDown(Enum.KeyCode.W) then
                move = move + Camera.CFrame.LookVector
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.S) then
                move = move - Camera.CFrame.LookVector
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.A) then
                move = move - Camera.CFrame.RightVector
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.D) then
                move = move + Camera.CFrame.RightVector
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.Space) then
                move = move + Vector3.new(0, 1, 0)
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.LeftControl) then
                move = move - Vector3.new(0, 1, 0)
            end

            if move.Magnitude > 0 then
                move = move.Unit * FlySpeed
            end

            flyBV.Velocity = move
            flyBG.CFrame = CFrame.lookAt(root.Position, root.Position + Camera.CFrame.LookVector)
        end
    end
end)

-- ========== ESP (ĞĞ¡ĞĞĞ’ĞĞĞ™ Ğ¦Ğ˜ĞšĞ›) ==========
RunService.RenderStepped:Connect(function()
    -- ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° ÑÑ‚Ğ°Ñ€Ñ‹Ñ… Ñ€Ğ°Ğ¼Ğ¾Ğº
    for _, child in pairs(ESP_Folder:GetChildren()) do
        child:Destroy()
    end

    -- Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ñ€Ğ°Ğ¼Ğ¾Ğº
    for _, player in pairs(Players:GetPlayers()) do
        if IsEnemy(player) then
            local char = player.Character
            if char then
                local hum = char:FindFirstChild("Humanoid")
                if hum and hum.Health > 0 then
                    for _, part in pairs(char:GetDescendants()) do
                        if part:IsA("BasePart") and part.Transparency < 1 then
                            local box = Instance.new("BoxHandleAdornment")
                            box.Name = part.Name
                            box.Adornee = part
                            box.AlwaysOnTop = true
                            box.ZIndex = 10
                            box.Size = part.Size * 1.05
                            box.Transparency = 0.3
                            box.Color = BrickColor.new("Bright yellow")
                            box.Parent = ESP_Folder
                        end
                    end
                end
            end
        end
    end
end)

print("âœ… ESP + FLY Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ñ‹. ĞĞ°Ğ¶Ğ¼Ğ¸ F, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ²ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ/Ğ²Ñ‹ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ»Ñ‘Ñ‚.")
