--[[
    ULTRA SIMPLE ESP — ПОДСВЕТИТ ВСЕХ ВРАГОВ В ЛЮБОЙ ИГРЕ
    - Работает через RenderStepped (пересоздаёт рамки каждый кадр)
    - Не требует сложных событий, поэтому 100% надёжно
    - Немного нагружает, но для Defusal достаточно
]]

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local CoreGui = (gethui and gethui()) or game:GetService("CoreGui")

if syn and syn.protect_gui then syn.protect_gui(CoreGui) elseif protect_gui then protect_gui(CoreGui) end

local LocalPlayer = Players.LocalPlayer

-- Контейнер для всех рамок (будем очищать каждый кадр)
local ESP_Folder = Instance.new("Folder")
ESP_Folder.Name = "ESP_Container"
ESP_Folder.Parent = CoreGui

-- Функция проверки враг/союзник (можно отключить TeamCheck)
local function IsEnemy(player)
    if player == LocalPlayer then return false end
    -- Если хочешь убрать TeamCheck, замени всё на return true
    if not player.Team or not LocalPlayer.Team then return true end
    return player.Team ~= LocalPlayer.Team
end

-- Главный цикл ESP
RunService.RenderStepped:Connect(function()
    -- Удаляем все старые рамки
    for _, child in pairs(ESP_Folder:GetChildren()) do
        child:Destroy()
    end

    -- Проходим по всем игрокам
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and IsEnemy(player) then
            local char = player.Character
            if char then
                local hum = char:FindFirstChild("Humanoid")
                if hum and hum.Health > 0 then
                    -- Ищем все части тела (даже вложенные)
                    for _, part in pairs(char:GetDescendants()) do
                        if part:IsA("BasePart") and part.Transparency < 1 then
                            -- Создаём рамку
                            local box = Instance.new("BoxHandleAdornment")
                            box.Name = part.Name
                            box.Adornee = part
                            box.AlwaysOnTop = true
                            box.ZIndex = 10
                            box.Size = part.Size * 1.05
                            box.Transparency = 0.3
                            box.Color = BrickColor.new("Bright yellow")
                            box.Parent = ESP_Folder
                        end
                    end
                end
            end
        end
    end
end)

print("✅ ULTRA SIMPLE ESP загружен. Если не видно врагов, проверь TeamCheck.")
