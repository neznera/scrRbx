--[[
    üîπ ESP + Aimbot + Fly üîπ
    - ESP: –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –≤—Å–µ—Ö —á–∞—Å—Ç–µ–π —Ç–µ–ª–∞ (–≤—Ä–∞–≥–∏ –∫—Ä–∞—Å–Ω—ã–µ, —Å–æ—é–∑–Ω–∏–∫–∏ –∑–µ–ª—ë–Ω—ã–µ)
    - Aimbot: –ª–µ–≥–∏—Ç–Ω–æ–µ –Ω–∞–≤–µ–¥–µ–Ω–∏–µ –Ω–∞ –≥–æ–ª–æ–≤—É –ø—Ä–∏ —É–¥–µ—Ä–∂–∞–Ω–∏–∏ U (–ø–ª–∞–≤–Ω–æ—Å—Ç—å —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç—Å—è)
    - Fly: –ø–æ–ª—ë—Ç –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ T (WASD + –ü—Ä–æ–±–µ–ª/Ctrl)
    –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –Ω–∞—á–∞–ª–µ —Å–∫—Ä–∏–ø—Ç–∞.
]]

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = (gethui and gethui()) or game:GetService("CoreGui")

if syn and syn.protect_gui then syn.protect_gui(CoreGui) elseif protect_gui then protect_gui(CoreGui) end

local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- ===== –ù–ê–°–¢–†–û–ô–ö–ò (–º–µ–Ω—è–π –ø–æ–¥ —Å–µ–±—è) =====
local Settings = {
    -- ESP
    ESP_Enabled = true,
    TeamCheck = true,          -- true: —Å–æ—é–∑–Ω–∏–∫–∏ –∑–µ–ª—ë–Ω—ã–µ, –≤—Ä–∞–≥–∏ –∫—Ä–∞—Å–Ω—ã–µ; false: –≤—Å–µ –∫—Ä–∞—Å–Ω—ã–µ

    -- Aimbot
    Aimbot_Enabled = true,
    Aimbot_Key = Enum.KeyCode.U,      -- –∫–ª–∞–≤–∏—à–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ (—É–¥–µ—Ä–∂–∏–≤–∞—Ç—å)
    FOV = 150,                        -- —Ä–∞–¥–∏—É—Å –ø–æ–∏—Å–∫–∞ —Ü–µ–ª–∏ –≤ –ø–∏–∫—Å–µ–ª—è—Ö
    Smoothness = 8,                   -- –ø–ª–∞–≤–Ω–æ—Å—Ç—å: 1 = –º–≥–Ω–æ–≤–µ–Ω–Ω–æ, –±–æ–ª—å—à–µ = –ø–ª–∞–≤–Ω–µ–µ

    -- Fly
    Fly_Enabled = false,
    Fly_Key = Enum.KeyCode.T,          -- –∫–ª–∞–≤–∏—à–∞ –≤–∫–ª/–≤—ã–∫–ª
    Fly_Speed = 50,
}

-- ===== ESP =====
local ESP_Folder = Instance.new("Folder")
ESP_Folder.Name = "ESP_Container"
ESP_Folder.Parent = CoreGui

local function GetTeamColor(player)
    if player == LocalPlayer then return nil end
    if Settings.TeamCheck then
        if not player.Team or not LocalPlayer.Team then
            return BrickColor.new("Bright red")
        end
        if player.Team == LocalPlayer.Team then
            return BrickColor.new("Bright green")
        else
            return BrickColor.new("Bright red")
        end
    else
        return BrickColor.new("Bright red")
    end
end

RunService.RenderStepped:Connect(function()
    if not Settings.ESP_Enabled then
        for _, child in pairs(ESP_Folder:GetChildren()) do
            child:Destroy()
        end
        return
    end

    -- –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Ä–∞–º–æ–∫
    for _, child in pairs(ESP_Folder:GetChildren()) do
        child:Destroy()
    end

    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            local color = GetTeamColor(player)
            if color then
                local char = player.Character
                if char then
                    local hum = char:FindFirstChild("Humanoid")
                    if hum and hum.Health > 0 then
                        for _, part in pairs(char:GetDescendants()) do
                            if part:IsA("BasePart") and part.Transparency < 1 then
                                local box = Instance.new("BoxHandleAdornment")
                                box.Name = part.Name
                                box.Adornee = part
                                box.AlwaysOnTop = true
                                box.ZIndex = 10
                                box.Size = part.Size * 1.05
                                box.Transparency = 0.3
                                box.Color = color
                                box.Parent = ESP_Folder
                            end
                        end
                    end
                end
            end
        end
    end
end)

-- ===== AIMBOT =====
local IsAiming = false

local function IsEnemy(player)
    if player == LocalPlayer then return false end
    if Settings.TeamCheck then
        if not player.Team or not LocalPlayer.Team then return true end
        return player.Team ~= LocalPlayer.Team
    end
    return true
end

local function GetTarget()
    if not Settings.Aimbot_Enabled then return nil end
    local mousePos = UserInputService:GetMouseLocation()
    local closest, closestDist = nil, Settings.FOV
    for _, player in pairs(Players:GetPlayers()) do
        if IsEnemy(player) then
            local char = player.Character
            if char then
                local hum = char:FindFirstChild("Humanoid")
                if hum and hum.Health > 0 then
                    local head = char:FindFirstChild("Head")
                    if head then
                        local vec, onScreen = Camera:WorldToViewportPoint(head.Position)
                        if onScreen then
                            local dist = (Vector2.new(vec.X, vec.Y) - mousePos).Magnitude
                            if dist < closestDist then
                                closestDist = dist
                                closest = player
                            end
                        end
                    end
                end
            end
        end
    end
    return closest
end

local function MoveMouseSmooth(targetX, targetY)
    local current = UserInputService:GetMouseLocation()
    local deltaX, deltaY = targetX - current.X, targetY - current.Y
    if math.abs(deltaX) < 0.5 and math.abs(deltaY) < 0.5 then return end

    local smooth = math.max(1, Settings.Smoothness)
    local moveX = deltaX / smooth
    local moveY = deltaY / smooth

    if mousemoverel then
        mousemoverel(moveX, moveY)
    elseif syn and syn.input then
        syn.input.MouseMove(moveX, moveY)
    elseif VirtualInputManager then
        VirtualInputManager:SendMouseMoveEvent(moveX, moveY, false)
    end
end

UserInputService.InputBegan:Connect(function(input, gp)
    if gp then return end
    if input.KeyCode == Settings.Aimbot_Key then
        IsAiming = true
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.KeyCode == Settings.Aimbot_Key then
        IsAiming = false
    end
end)

RunService.RenderStepped:Connect(function()
    if IsAiming and Settings.Aimbot_Enabled then
        local target = GetTarget()
        if target and target.Character then
            local head = target.Character:FindFirstChild("Head")
            if head then
                local vec, onScreen = Camera:WorldToViewportPoint(head.Position)
                if onScreen then
                    MoveMouseSmooth(vec.X, vec.Y)
                end
            end
        end
    end
end)

-- ===== FLY =====
local flyBodyVelocity, flyBodyGyro, flyConnection

local function EnableFly()
    local char = LocalPlayer.Character
    if not char then return end
    local root = char:FindFirstChild("HumanoidRootPart")
    local hum = char:FindFirstChild("Humanoid")
    if not root or not hum then return end

    hum.PlatformStand = true

    flyBodyVelocity = Instance.new("BodyVelocity")
    flyBodyVelocity.MaxForce = Vector3.new(4000, 4000, 4000)
    flyBodyVelocity.Velocity = Vector3.new(0, 0, 0)
    flyBodyVelocity.Parent = root

    flyBodyGyro = Instance.new("BodyGyro")
    flyBodyGyro.MaxTorque = Vector3.new(4000, 4000, 4000)
    flyBodyGyro.P = 1000
    flyBodyGyro.D = 200
    flyBodyGyro.CFrame = root.CFrame
    flyBodyGyro.Parent = root

    Settings.Fly_Enabled = true
end

local function DisableFly()
    Settings.Fly_Enabled = false
    if flyBodyVelocity then flyBodyVelocity:Destroy() flyBodyVelocity = nil end
    if flyBodyGyro then flyBodyGyro:Destroy() flyBodyGyro = nil end
    local char = LocalPlayer.Character
    if char then
        local hum = char:FindFirstChild("Humanoid")
        if hum then hum.PlatformStand = false end
    end
end

local function ToggleFly()
    if Settings.Fly_Enabled then
        DisableFly()
    else
        EnableFly()
    end
end

UserInputService.InputBegan:Connect(function(input, gp)
    if gp then return end
    if input.KeyCode == Settings.Fly_Key then
        ToggleFly()
    end
end)

-- –¶–∏–∫–ª –ø–æ–ª—ë—Ç–∞
flyConnection = RunService.Heartbeat:Connect(function()
    if Settings.Fly_Enabled and LocalPlayer.Character then
        local root = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if root and flyBodyVelocity and flyBodyGyro then
            local move = Vector3.new()
            if UserInputService:IsKeyDown(Enum.KeyCode.W) then
                move = move + Camera.CFrame.LookVector
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.S) then
                move = move - Camera.CFrame.LookVector
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.A) then
                move = move - Camera.CFrame.RightVector
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.D) then
                move = move + Camera.CFrame.RightVector
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.Space) then
                move = move + Vector3.new(0, 1, 0)
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.LeftControl) then
                move = move - Vector3.new(0, 1, 0)
            end
            if move.Magnitude > 0 then
                move = move.Unit * Settings.Fly_Speed
            end
            flyBodyVelocity.Velocity = move
            flyBodyGyro.CFrame = CFrame.lookAt(root.Position, root.Position + Camera.CFrame.LookVector)
        end
    end
end)

-- –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ —Ä–µ—Å–ø–∞–≤–Ω–µ
LocalPlayer.CharacterAdded:Connect(function()
    if Settings.Fly_Enabled then
        DisableFly()
    end
end)

print("‚úÖ ESP + Aimbot + Fly –∑–∞–≥—Ä—É–∂–µ–Ω—ã. –ù–∞—Å—Ç—Ä–æ–π–∫–∏:")
print("   U ‚Äì —É–¥–µ—Ä–∂–∏–≤–∞—Ç—å –¥–ª—è –∞–∏–º–∞")
print("   T ‚Äì –≤–∫–ª/–≤—ã–∫–ª –ø–æ–ª—ë—Ç")
print("   TeamCheck =", Settings.TeamCheck, " FOV =", Settings.FOV, " Smoothness =", Settings.Smoothness)
