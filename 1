--[[
    âš¡ ULTIMATE COMBAT SCRIPT âš¡
    - ESP: Ð²Ñ€Ð°Ð³Ð¸ ÐºÑ€Ð°ÑÐ½Ñ‹Ðµ, ÑÐ¾ÑŽÐ·Ð½Ð¸ÐºÐ¸ Ð·ÐµÐ»Ñ‘Ð½Ñ‹Ðµ (Ð²ÑÐµÐ³Ð´Ð°)
    - Aimbot (ÐŸÐšÐœ) Ñ Ð¾Ð¿Ñ†Ð¸ÐµÐ¹ Wallbang (ÐºÐ»Ð°Ð²Ð¸ÑˆÐ° B)
    - No Recoil (ÐºÐ»Ð°Ð²Ð¸ÑˆÐ° N)
    - Infinite Ammo (ÐºÐ»Ð°Ð²Ð¸ÑˆÐ° M)

    Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ:
        ÐŸÐšÐœ â€“ Ð°Ð¸Ð¼Ð±Ð¾Ñ‚ (Ð½Ð°Ð²Ð¾Ð´Ð¸Ñ‚ÑÑ Ð½Ð° Ð±Ð»Ð¸Ð¶Ð°Ð¹ÑˆÐµÐ³Ð¾ Ð²Ñ€Ð°Ð³Ð° Ð² FOV)
        B â€“ Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Wallbang (Ð¸Ð³Ð½Ð¾Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ÑÑ‚ÐµÐ½)
        N â€“ Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ No Recoil
        M â€“ Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Infinite Ammo
]]

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = (gethui and gethui()) or game:GetService("CoreGui")

if syn and syn.protect_gui then syn.protect_gui(CoreGui) elseif protect_gui then protect_gui(CoreGui) end

local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- ========== ÐÐÐ¡Ð¢Ð ÐžÐ™ÐšÐ˜ ==========
local Settings = {
    -- Aimbot
    Aimbot_Enabled = true,
    FOV = 200,
    Wallbang = false,          -- Ð¸Ð³Ð½Ð¾Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÑÑ‚ÐµÐ½Ñ‹ (Ð¿Ð¾ ÐºÐ»Ð°Ð²Ð¸ÑˆÐµ B)
    
    -- No Recoil
    NoRecoil = false,
    
    -- Infinite Ammo
    InfiniteAmmo = false,
}

-- ========== ÐŸÐ•Ð Ð•ÐœÐ•ÐÐÐ«Ð• ==========
local ESP_Folder = Instance.new("Folder")
ESP_Folder.Name = "ESP_Container"
ESP_Folder.Parent = CoreGui

local IsAiming = false

-- ========== ESP (Ð ÐÐ—ÐÐ«Ð• Ð¦Ð’Ð•Ð¢Ð) ==========
local function GetTeamColor(player)
    if player == LocalPlayer then return nil end
    if not player.Team or not LocalPlayer.Team then
        -- ÐµÑÐ»Ð¸ Ð½ÐµÑ‚ ÐºÐ¾Ð¼Ð°Ð½Ð´, ÑÑ‡Ð¸Ñ‚Ð°ÐµÐ¼ Ð²ÑÐµÑ… Ð²Ñ€Ð°Ð³Ð°Ð¼Ð¸ (ÐºÑ€Ð°ÑÐ½Ñ‹Ð¹)
        return BrickColor.new("Bright red")
    end
    if player.Team == LocalPlayer.Team then
        return BrickColor.new("Bright green")   -- ÑÐ¾ÑŽÐ·Ð½Ð¸ÐºÐ¸ Ð·ÐµÐ»Ñ‘Ð½Ñ‹Ðµ
    else
        return BrickColor.new("Bright red")     -- Ð²Ñ€Ð°Ð³Ð¸ ÐºÑ€Ð°ÑÐ½Ñ‹Ðµ
    end
end

RunService.RenderStepped:Connect(function()
    -- Ð£Ð´Ð°Ð»ÑÐµÐ¼ Ð²ÑÐµ ÑÑ‚Ð°Ñ€Ñ‹Ðµ Ñ€Ð°Ð¼ÐºÐ¸
    for _, child in pairs(ESP_Folder:GetChildren()) do
        child:Destroy()
    end

    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            local color = GetTeamColor(player)
            if color then
                local char = player.Character
                if char then
                    local hum = char:FindFirstChild("Humanoid")
                    if hum and hum.Health > 0 then
                        for _, part in pairs(char:GetDescendants()) do
                            if part:IsA("BasePart") and part.Transparency < 1 then
                                local box = Instance.new("BoxHandleAdornment")
                                box.Name = part.Name
                                box.Adornee = part
                                box.AlwaysOnTop = true
                                box.ZIndex = 10
                                box.Size = part.Size * 1.05
                                box.Transparency = 0.3
                                box.Color = color
                                box.Parent = ESP_Folder
                            end
                        end
                    end
                end
            end
        end
    end
end)

-- ========== AIMBOT (Ð¡ WALLBANG) ==========
local function IsVisible(character)
    if Settings.Wallbang then return true end
    local head = character:FindFirstChild("Head")
    if not head then return false end
    local origin = Camera.CFrame.Position
    local direction = head.Position - origin
    local ray = Ray.new(origin, direction.Unit * direction.Magnitude)
    local hit = workspace:FindPartOnRayWithIgnoreList(ray, {LocalPlayer.Character, Camera})
    return hit and hit:IsDescendantOf(character)
end

local function GetTarget()
    if not Settings.Aimbot_Enabled then return nil end
    local mousePos = UserInputService:GetMouseLocation()
    local closestPlayer, closestDist = nil, Settings.FOV
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character then
            local hum = player.Character:FindFirstChild("Humanoid")
            if hum and hum.Health > 0 then
                if IsVisible(player.Character) then
                    local targetPart = player.Character:FindFirstChild("HumanoidRootPart") or player.Character:FindFirstChild("Torso") or player.Character:FindFirstChild("UpperTorso") or player.Character:FindFirstChild("Head")
                    if targetPart then
                        local vec, onScreen = Camera:WorldToViewportPoint(targetPart.Position)
                        if onScreen then
                            local dist = (Vector2.new(vec.X, vec.Y) - mousePos).Magnitude
                            if dist < closestDist then
                                closestDist = dist
                                closestPlayer = player
                            end
                        end
                    end
                end
            end
        end
    end
    return closestPlayer
end

local function MoveMouse(targetX, targetY)
    local current = UserInputService:GetMouseLocation()
    local deltaX, deltaY = targetX - current.X, targetY - current.Y
    if math.abs(deltaX) < 0.5 and math.abs(deltaY) < 0.5 then return end
    if mousemoverel then
        mousemoverel(deltaX, deltaY)
    elseif syn and syn.input then
        syn.input.MouseMove(deltaX, deltaY)
    elseif VirtualInputManager then
        VirtualInputManager:SendMouseMoveEvent(deltaX, deltaY, false)
    end
end

UserInputService.InputBegan:Connect(function(input, gp)
    if not gp and input.UserInputType == Enum.UserInputType.MouseButton2 then
        IsAiming = true
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton2 then
        IsAiming = false
    end
end)

RunService.RenderStepped:Connect(function()
    if IsAiming and Settings.Aimbot_Enabled then
        local target = GetTarget()
        if target then
            local char = target.Character
            if char then
                local targetPart = char:FindFirstChild("HumanoidRootPart") or char:FindFirstChild("Torso") or char:FindFirstChild("UpperTorso") or char:FindFirstChild("Head")
                if targetPart then
                    local vec, onScreen = Camera:WorldToViewportPoint(targetPart.Position)
                    if onScreen then
                        MoveMouse(vec.X, vec.Y)
                    end
                end
            end
        end
    end
end)

-- ========== NO RECOIL ==========
local function ApplyNoRecoil()
    if not Settings.NoRecoil then return end
    local char = LocalPlayer.Character
    if not char then return end
    local tool = char:FindFirstChildOfClass("Tool") or char:FindFirstChildWhichIsA("Tool")
    if tool then
        local props = {"Recoil", "Bloom", "Spread", "Deviation", "CameraRecoil", "RecoilMax", "RecoilMin", "Shake", "Sway"}
        for _, prop in ipairs(props) do
            pcall(function()
                if tool:FindFirstChild(prop) then
                    tool[prop].Value = 0
                end
                if tool[prop] ~= nil then
                    tool[prop] = 0
                end
            end)
        end
    end
end

-- ========== INFINITE AMMO ==========
local function ApplyInfiniteAmmo()
    if not Settings.InfiniteAmmo then return end
    local char = LocalPlayer.Character
    if not char then return end
    local tool = char:FindFirstChildOfClass("Tool") or char:FindFirstChildWhichIsA("Tool")
    if tool then
        local ammoProps = {"Ammo", "CurrentAmmo", "Clip", "Magazine", "ReserveAmmo", "MaxAmmo"}
        for _, prop in ipairs(ammoProps) do
            pcall(function()
                if tool:FindFirstChild(prop) then
                    tool[prop].Value = 9999
                end
                if tool[prop] ~= nil then
                    if type(tool[prop]) == "number" then
                        tool[prop] = 9999
                    end
                end
            end)
        end
        -- Ð”Ð»Ñ Ð½ÐµÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ñ… Ð¸Ð³Ñ€ (Configuration)
        pcall(function()
            if tool:FindFirstChild("Configuration") then
                local cfg = tool.Configuration
                if cfg:FindFirstChild("AmmoCount") then cfg.AmmoCount.Value = 9999 end
                if cfg:FindFirstChild("MaxAmmo") then cfg.MaxAmmo.Value = 9999 end
            end
        end)
    end
end

-- ÐŸÑ€Ð¸Ð¼ÐµÐ½ÑÐµÐ¼ ÑÑ„Ñ„ÐµÐºÑ‚Ñ‹ Ð² Ñ†Ð¸ÐºÐ»Ðµ
RunService.Heartbeat:Connect(function()
    ApplyNoRecoil()
    ApplyInfiniteAmmo()
end)

-- ========== Ð£ÐŸÐ ÐÐ’Ð›Ð•ÐÐ˜Ð• ÐšÐ›ÐÐ’Ð˜Ð¨ÐÐœÐ˜ ==========
UserInputService.InputBegan:Connect(function(input, gp)
    if gp then return end
    if input.KeyCode == Enum.KeyCode.B then
        Settings.Wallbang = not Settings.Wallbang
        print("ðŸŸ¢ Wallbang: " .. (Settings.Wallbang and "ON" or "OFF"))
    elseif input.KeyCode == Enum.KeyCode.N then
        Settings.NoRecoil = not Settings.NoRecoil
        print("ðŸŸ¢ No Recoil: " .. (Settings.NoRecoil and "ON" or "OFF"))
    elseif input.KeyCode == Enum.KeyCode.M then
        Settings.InfiniteAmmo = not Settings.InfiniteAmmo
        print("ðŸŸ¢ Infinite Ammo: " .. (Settings.InfiniteAmmo and "ON" or "OFF"))
    end
end)

-- Ð¡Ð±Ñ€Ð¾Ñ Ð¿Ñ€Ð¸ Ñ€ÐµÑÐ¿Ð°Ð²Ð½Ðµ (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾)
LocalPlayer.CharacterAdded:Connect(function()
    -- ÐÐ¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ ÑÐ±Ñ€Ð°ÑÑ‹Ð²Ð°ÐµÐ¼, Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð°Ñ‚ Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÑÑ‚ÑŒÑÑ Ð¿Ð¾ÑÐ»Ðµ Ñ€ÐµÑÐ¿Ð°Ð²Ð½Ð°
end)

print("âœ… Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½. Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ:")
print("   ÐŸÐšÐœ â€“ Ð°Ð¸Ð¼Ð±Ð¾Ñ‚")
print("   B â€“ Wallbang (Ð¸Ð³Ð½Ð¾Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ÑÑ‚ÐµÐ½)")
print("   N â€“ No Recoil (Ð±ÐµÐ· Ð¾Ñ‚Ð´Ð°Ñ‡Ð¸)")
print("   M â€“ Infinite Ammo (Ð±ÐµÑÐºÐ¾Ð½ÐµÑ‡Ð½Ñ‹Ðµ Ð¿Ð°Ñ‚Ñ€Ð¾Ð½Ñ‹)")
print("ESP: Ð²Ñ€Ð°Ð³Ð¸ ÐºÑ€Ð°ÑÐ½Ñ‹Ðµ, ÑÐ¾ÑŽÐ·Ð½Ð¸ÐºÐ¸ Ð·ÐµÐ»Ñ‘Ð½Ñ‹Ðµ")
