local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

local ESP_Drawings = setmetatable({}, {__mode = "v"})

RunService.RenderStepped:Connect(function()
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("Humanoid") and player.Character.Humanoid.Health > 0 then
            local head = player.Character:FindFirstChild("Head")
            if head then
                local pos, onScreen = Camera:WorldToViewportPoint(head.Position)
                if onScreen then
                    if not ESP_Drawings[player] then
                        ESP_Drawings[player] = Drawing.new("Circle")
                        ESP_Drawings[player].Radius = 20
                        ESP_Drawings[player].Filled = false
                        ESP_Drawings[player].Thickness = 2
                        ESP_Drawings[player].Color = Color3.fromRGB(255,255,0)
                    end
                    ESP_Drawings[player].Position = Vector2.new(pos.X, pos.Y)
                    ESP_Drawings[player].Visible = true
                else
                    if ESP_Drawings[player] then
                        ESP_Drawings[player].Visible = false
                    end
                end
            end
        else
            if ESP_Drawings[player] then
                ESP_Drawings[player].Visible = false
            end
        end
    end
end)
