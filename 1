local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = (gethui and gethui()) or game:GetService("CoreGui")

-- Защита CoreGui
if syn and syn.protect_gui then
    syn.protect_gui(CoreGui)
elseif protect_gui then
    protect_gui(CoreGui)
end

local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- ===== СЛУЧАЙНЫЕ ИМЕНА =====
local function randomString(len)
    local str = ""
    for i = 1, len do
        str = str .. string.char(math.random(65, 90))
    end
    return str
end

-- ===== НАСТРОЙКИ =====
local Settings = {
    Aimbot_Enabled = true,
    TeamCheck = true,
    FOV = 120,
}

-- ===== ПЕРЕМЕННЫЕ =====
local IsAiming = false
local MenuOpen = true
local Dragging = false
local DragStart, DragPos

-- ===== AIMBOT =====
local function IsTeamMate(p)
    if not Settings.TeamCheck then return false end
    if not p.Team or not LocalPlayer.Team then return false end
    return p.Team == LocalPlayer.Team
end

local function GetClosestToMouse()
    if not Settings.Aimbot_Enabled then return nil end
    local mousePos = UserInputService:GetMouseLocation()
    local closest, closestDist = nil, Settings.FOV

    for _, p in pairs(Players:GetPlayers()) do
        if p ~= LocalPlayer and p.Character and p.Character:FindFirstChild("Humanoid") and p.Character.Humanoid.Health > 0 then
            if not IsTeamMate(p) then
                local head = p.Character:FindFirstChild("Head")
                if head then
                    local vec, onScreen = Camera:WorldToViewportPoint(head.Position)
                    if onScreen then
                        local dist = (Vector2.new(vec.X, vec.Y) - mousePos).Magnitude
                        if dist < closestDist then
                            closestDist = dist
                            closest = p
                        end
                    end
                end
            end
        end
    end
    return closest
end

-- Мгновенное перемещение мыши (не легит)
local function MoveMouseInstant(targetX, targetY)
    local current = UserInputService:GetMouseLocation()
    local delta = Vector2.new(targetX - current.X, targetY - current.Y)
    if delta.Magnitude < 0.5 then return end
    if mousemoverel then
        mousemoverel(delta.X, delta.Y)
    elseif syn and syn.input then
        syn.input.MouseMove(delta.X, delta.Y)
    elseif VirtualInputManager then
        VirtualInputManager:SendMouseMoveEvent(delta.X, delta.Y, false)
    end
end

-- Управление клавишей (ПКМ)
UserInputService.InputBegan:Connect(function(input, gp)
    if not gp and input.UserInputType == Enum.UserInputType.MouseButton2 then
        IsAiming = true
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton2 then
        IsAiming = false
    end
end)

-- Главный цикл
RunService.RenderStepped:Connect(function()
    if Settings.Aimbot_Enabled and IsAiming then
        local target = GetClosestToMouse()
        if target and target.Character and target.Character:FindFirstChild("Head") then
            local head = target.Character.Head
            local vec, onScreen = Camera:WorldToViewportPoint(head.Position)
            if onScreen then
                MoveMouseInstant(vec.X, vec.Y)
            end
        end
    end
end)

-- ===== МЕНЮ =====
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = randomString(12)
ScreenGui.Parent = CoreGui
if syn and syn.protect_gui then
    syn.protect_gui(ScreenGui)
elseif protect_gui then
    protect_gui(ScreenGui)
end

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 200, 0, 130)
MainFrame.Position = UDim2.new(0, 50, 0, 50)
MainFrame.BackgroundColor3 = Color3.fromRGB(30,30,30)
MainFrame.BackgroundTransparency = 0.2
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Parent = ScreenGui

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0,6)
UICorner.Parent = MainFrame

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1,0,0,30)
Title.BackgroundTransparency = 1
Title.Text = "Aimbot (Instant)"
Title.TextColor3 = Color3.new(1,1,1)
Title.Font = Enum.Font.SourceSansBold
Title.TextSize = 18
Title.Parent = MainFrame

local yPos = 40
local function CreateCheckbox(text, getter, setter)
    local box = Instance.new("TextButton")
    box.Size = UDim2.new(0,20,0,20)
    box.Position = UDim2.new(0,10,0,yPos)
    box.BackgroundColor3 = getter() and Color3.fromRGB(0,255,0) or Color3.fromRGB(60,60,60)
    box.Text = ""
    box.Parent = MainFrame
    local lbl = Instance.new("TextLabel")
    lbl.Size = UDim2.new(1,-40,0,20)
    lbl.Position = UDim2.new(0,40,0,yPos)
    lbl.BackgroundTransparency = 1
    lbl.Text = text
    lbl.TextColor3 = Color3.new(1,1,1)
    lbl.TextXAlignment = Enum.TextXAlignment.Left
    lbl.Font = Enum.Font.SourceSans
    lbl.TextSize = 16
    lbl.Parent = MainFrame
    box.MouseButton1Click:Connect(function()
        local new = not getter()
        setter(new)
        box.BackgroundColor3 = new and Color3.fromRGB(0,255,0) or Color3.fromRGB(60,60,60)
    end)
    yPos = yPos + 30
end

CreateCheckbox("Aimbot", function() return Settings.Aimbot_Enabled end, function(v) Settings.Aimbot_Enabled = v end)
CreateCheckbox("Team Check", function() return Settings.TeamCheck end, function(v) Settings.TeamCheck = v end)

local fovLabel = Instance.new("TextLabel")
fovLabel.Size = UDim2.new(0, 80, 0, 25)
fovLabel.Position = UDim2.new(0,10,0,yPos)
fovLabel.BackgroundTransparency = 1
fovLabel.Text = "FOV: " .. Settings.FOV
fovLabel.TextColor3 = Color3.new(1,1,1)
fovLabel.Font = Enum.Font.SourceSans
fovLabel.TextSize = 16
fovLabel.TextXAlignment = Enum.TextXAlignment.Left
fovLabel.Parent = MainFrame

local fovMinus = Instance.new("TextButton")
fovMinus.Size = UDim2.new(0,25,0,25)
fovMinus.Position = UDim2.new(0,120,0,yPos)
fovMinus.Text = "-"
fovMinus.BackgroundColor3 = Color3.fromRGB(80,80,80)
fovMinus.Parent = MainFrame
fovMinus.MouseButton1Click:Connect(function()
    Settings.FOV = math.max(30, Settings.FOV - 10)
    fovLabel.Text = "FOV: " .. Settings.FOV
end)

local fovPlus = Instance.new("TextButton")
fovPlus.Size = UDim2.new(0,25,0,25)
fovPlus.Position = UDim2.new(0,150,0,yPos)
fovPlus.Text = "+"
fovPlus.BackgroundColor3 = Color3.fromRGB(80,80,80)
fovPlus.Parent = MainFrame
fovPlus.MouseButton1Click:Connect(function()
    Settings.FOV = math.min(300, Settings.FOV + 10)
    fovLabel.Text = "FOV: " .. Settings.FOV
end)

print("✅ Aimbot (instant) loaded. Hold RMB to snap to head.")
