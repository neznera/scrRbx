--[[
    âš¡ ULTIMATE SCRIPT v2 âš¡
    - ESP (Ğ¶Ñ‘Ğ»Ñ‚Ñ‹Ğµ Ñ€Ğ°Ğ¼ĞºĞ¸ Ğ½Ğ° Ğ²Ñ€Ğ°Ğ³Ğ¾Ğ²)
    - Legit Fly
    - Legit Speed
    - Health Boost
    - Teleport to enemy (Ğ¿Ğ¾Ğ´ÑŠÑ‘Ğ¼ Ğ¸ Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸Ğµ)
    Team Check Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¹.
    Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ:
        F  â€” Ğ¿Ğ¾Ğ»Ñ‘Ñ‚
        G  â€” ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ
        H  â€” Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµ
        T  â€” Ñ‚ĞµĞ»ĞµĞ¿Ğ¾Ñ€Ñ‚ Ğ½Ğ° Ğ¸Ğ³Ñ€Ğ¾ĞºĞ° Ğ¿Ğ¾Ğ´ Ğ¿Ñ€Ğ¸Ñ†ĞµĞ»Ğ¾Ğ¼ (Ğ²Ğ²ĞµÑ€Ñ… Ğ¸ Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸Ğµ)
]]

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = (gethui and gethui()) or game:GetService("CoreGui")

if syn and syn.protect_gui then syn.protect_gui(CoreGui) elseif protect_gui then protect_gui(CoreGui) end

local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local Mouse = LocalPlayer:GetMouse()

-- ========== ĞĞĞ¡Ğ¢Ğ ĞĞ™ĞšĞ˜ ==========
local Settings = {
    -- ESP
    ESP_Enabled = true,
    TeamCheck = true,        -- ÑƒÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°Ñ‚ÑŒ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹

    -- Legit Fly
    Fly_Enabled = false,
    Fly_Speed = 50,
    Fly_Key = Enum.KeyCode.F,

    -- Legit Speed
    Speed_Enabled = false,
    Speed_Value = 32,
    Speed_Key = Enum.KeyCode.G,

    -- Health Boost
    Health_Enabled = false,
    Health_Target = 9999,
    Health_Key = Enum.KeyCode.H,

    -- Teleport
    Teleport_Key = Enum.KeyCode.T,
    Teleport_Height = 50,     -- Ğ²Ñ‹ÑĞ¾Ñ‚Ğ° Ğ¿Ğ¾Ğ´ÑŠÑ‘Ğ¼Ğ° Ğ½Ğ°Ğ´ Ñ†ĞµĞ»ÑŒÑ
}

-- ========== ESP ==========
local ESP_Folder = Instance.new("Folder")
ESP_Folder.Name = "ESP_Container"
ESP_Folder.Parent = CoreGui

local function IsEnemy(player)
    if player == LocalPlayer then return false end
    if Settings.TeamCheck then
        if not player.Team or not LocalPlayer.Team then return true end
        return player.Team ~= LocalPlayer.Team
    end
    return true
end

-- ========== FLY ==========
local flyBodyVelocity = nil
local flyBodyGyro = nil
local flyConnection = nil

local function EnableFly()
    local char = LocalPlayer.Character
    if not char then return end
    local root = char:FindFirstChild("HumanoidRootPart")
    local hum = char:FindFirstChild("Humanoid")
    if not root or not hum then return end

    hum.PlatformStand = true

    flyBodyVelocity = Instance.new("BodyVelocity")
    flyBodyVelocity.MaxForce = Vector3.new(4000, 4000, 4000)
    flyBodyVelocity.Velocity = Vector3.new(0, 0, 0)
    flyBodyVelocity.P = 1000
    flyBodyVelocity.Parent = root

    flyBodyGyro = Instance.new("BodyGyro")
    flyBodyGyro.MaxTorque = Vector3.new(4000, 4000, 4000)
    flyBodyGyro.P = 1000
    flyBodyGyro.D = 200
    flyBodyGyro.CFrame = root.CFrame
    flyBodyGyro.Parent = root

    Settings.Fly_Enabled = true
end

local function DisableFly()
    Settings.Fly_Enabled = false
    if flyBodyVelocity then flyBodyVelocity:Destroy() flyBodyVelocity = nil end
    if flyBodyGyro then flyBodyGyro:Destroy() flyBodyGyro = nil end
    local char = LocalPlayer.Character
    if char then
        local hum = char:FindFirstChild("Humanoid")
        if hum then hum.PlatformStand = false end
    end
end

local function ToggleFly()
    if Settings.Fly_Enabled then DisableFly() else EnableFly() end
end

flyConnection = RunService.Heartbeat:Connect(function()
    if Settings.Fly_Enabled and LocalPlayer.Character then
        local root = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if root and flyBodyVelocity and flyBodyGyro then
            local move = Vector3.new()
            if UserInputService:IsKeyDown(Enum.KeyCode.W) then move = move + Camera.CFrame.LookVector end
            if UserInputService:IsKeyDown(Enum.KeyCode.S) then move = move - Camera.CFrame.LookVector end
            if UserInputService:IsKeyDown(Enum.KeyCode.A) then move = move - Camera.CFrame.RightVector end
            if UserInputService:IsKeyDown(Enum.KeyCode.D) then move = move + Camera.CFrame.RightVector end
            if UserInputService:IsKeyDown(Enum.KeyCode.Space) then move = move + Vector3.new(0, 1, 0) end
            if UserInputService:IsKeyDown(Enum.KeyCode.LeftControl) then move = move - Vector3.new(0, 1, 0) end
            if move.Magnitude > 0 then move = move.Unit * Settings.Fly_Speed end
            flyBodyVelocity.Velocity = move
            flyBodyGyro.CFrame = CFrame.lookAt(root.Position, root.Position + Camera.CFrame.LookVector)
        end
    end
end)

-- ========== SPEED ==========
local function ApplySpeed()
    local char = LocalPlayer.Character
    if char then
        local hum = char:FindFirstChild("Humanoid")
        if hum then
            hum.WalkSpeed = Settings.Speed_Enabled and Settings.Speed_Value or 16
        end
    end
end

local function ToggleSpeed()
    Settings.Speed_Enabled = not Settings.Speed_Enabled
    ApplySpeed()
end

-- ========== HEALTH ==========
local healthConnection = nil
local function ApplyHealth()
    if not Settings.Health_Enabled then
        if healthConnection then healthConnection:Disconnect() healthConnection = nil end
        return
    end
    if healthConnection then healthConnection:Disconnect() end
    healthConnection = RunService.Heartbeat:Connect(function()
        local char = LocalPlayer.Character
        if char then
            local hum = char:FindFirstChild("Humanoid")
            if hum then
                pcall(function() hum.Health = Settings.Health_Target end)
            end
        end
    end)
end

local function ToggleHealth()
    Settings.Health_Enabled = not Settings.Health_Enabled
    ApplyHealth()
end

-- ========== TELEPORT ==========
local function TeleportToTarget(targetPlayer)
    if not targetPlayer then return end
    if Settings.TeamCheck and not IsEnemy(targetPlayer) then
        print("â›” ĞĞµĞ»ÑŒĞ·Ñ Ñ‚ĞµĞ»ĞµĞ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒÑÑ Ğº ÑĞ¾ÑĞ·Ğ½Ğ¸ĞºÑƒ (TeamCheck)")
        return
    end
    local char = LocalPlayer.Character
    local targetChar = targetPlayer.Character
    if not char or not targetChar then return end
    local root = char:FindFirstChild("HumanoidRootPart")
    local targetRoot = targetChar:FindFirstChild("HumanoidRootPart") or targetChar:FindFirstChild("Torso") or targetChar:FindFirstChild("UpperTorso")
    if not root or not targetRoot then return end

    -- ĞŸĞ¾Ğ´Ğ½Ğ¸Ğ¼Ğ°ĞµĞ¼ÑÑ Ğ½Ğ°Ğ´ Ñ†ĞµĞ»ÑŒÑ
    local targetPos = targetRoot.Position
    local newPos = Vector3.new(targetPos.X, targetPos.Y + Settings.Teleport_Height, targetPos.Z)
    root.CFrame = CFrame.new(newPos)

    -- Ğ§ĞµÑ€ĞµĞ· Ğ½ĞµĞ±Ğ¾Ğ»ÑŒÑˆÑƒÑ Ğ·Ğ°Ğ´ĞµÑ€Ğ¶ĞºÑƒ Ğ¸Ğ³Ñ€Ğ¾Ğº ÑƒĞ¿Ğ°Ğ´Ñ‘Ñ‚ (Ğ³Ñ€Ğ°Ğ²Ğ¸Ñ‚Ğ°Ñ†Ğ¸Ñ ÑĞ´ĞµĞ»Ğ°ĞµÑ‚ ÑĞ²Ğ¾Ñ‘ Ğ´ĞµĞ»Ğ¾)
    -- ĞœĞ¾Ğ¶Ğ½Ğ¾ ÑÑ€Ğ°Ğ·Ñƒ, Ğ½Ğ¾ Ğ¿ÑƒÑÑ‚ÑŒ Ğ¿Ğ°Ğ´Ğ°ĞµÑ‚ ÑĞ°Ğ¼.
    print("â¬†ï¸ Ğ¢ĞµĞ»ĞµĞ¿Ğ¾Ñ€Ñ‚ Ğ½Ğ°Ğ´ " .. targetPlayer.Name .. ", Ğ¿Ğ°Ğ´Ğ°Ğ¹!")
end

-- Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ° Ğ¿Ğ¾Ğ´ Ğ¿Ñ€Ğ¸Ñ†ĞµĞ»Ğ¾Ğ¼
local function GetPlayerUnderMouse()
    local target = Mouse.Target
    if not target then return nil end
    local player = Players:GetPlayerFromCharacter(target.Parent)
    if player then return player end
    -- Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ñ‡Ğ°ÑÑ‚ÑŒÑ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ (Accessory Ğ¸ Ñ‚.Ğ´.) Ğ¸Ñ‰ĞµĞ¼ Ñ€Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»Ñ-Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ
    local model = target.Parent
    while model and model ~= workspace do
        player = Players:GetPlayerFromCharacter(model)
        if player then return player end
        model = model.Parent
    end
    return nil
end

-- ========== Ğ£ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ˜Ğ• ĞšĞ›ĞĞ’Ğ˜Ğ¨ĞĞœĞ˜ ==========
UserInputService.InputBegan:Connect(function(input, gp)
    if gp then return end
    if input.KeyCode == Settings.Fly_Key then
        ToggleFly()
        print("ğŸ•Šï¸ Fly: " .. (Settings.Fly_Enabled and "ON" or "OFF"))
    elseif input.KeyCode == Settings.Speed_Key then
        ToggleSpeed()
        print("âš¡ Speed: " .. (Settings.Speed_Enabled and "ON" or "OFF"))
    elseif input.KeyCode == Settings.Health_Key then
        ToggleHealth()
        print("â¤ï¸ Health: " .. (Settings.Health_Enabled and "ON" or "OFF"))
    elseif input.KeyCode == Settings.Teleport_Key then
        local target = GetPlayerUnderMouse()
        if target then
            TeleportToTarget(target)
        else
            print("âŒ ĞĞµÑ‚ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ° Ğ¿Ğ¾Ğ´ Ğ¿Ñ€Ğ¸Ñ†ĞµĞ»Ğ¾Ğ¼")
        end
    end
end)

-- Ğ¡Ğ±Ñ€Ğ¾Ñ Ğ¿Ñ€Ğ¸ Ñ€ĞµÑĞ¿Ğ°Ğ²Ğ½Ğµ
LocalPlayer.CharacterAdded:Connect(function()
    if Settings.Fly_Enabled then DisableFly() end
    if Settings.Speed_Enabled then ApplySpeed() end
    if Settings.Health_Enabled then ApplyHealth() end
end)

-- ========== ESP ==========
RunService.RenderStepped:Connect(function()
    for _, child in pairs(ESP_Folder:GetChildren()) do
        child:Destroy()
    end
    if not Settings.ESP_Enabled then return end
    for _, player in pairs(Players:GetPlayers()) do
        if IsEnemy(player) then
            local char = player.Character
            if char then
                local hum = char:FindFirstChild("Humanoid")
                if hum and hum.Health > 0 then
                    for _, part in pairs(char:GetDescendants()) do
                        if part:IsA("BasePart") and part.Transparency < 1 then
                            local box = Instance.new("BoxHandleAdornment")
                            box.Name = part.Name
                            box.Adornee = part
                            box.AlwaysOnTop = true
                            box.ZIndex = 10
                            box.Size = part.Size * 1.05
                            box.Transparency = 0.3
                            box.Color = BrickColor.new("Bright yellow")
                            box.Parent = ESP_Folder
                        end
                    end
                end
            end
        end
    end
end)

-- ĞŸÑ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ Ğ¿Ñ€Ğ¸ ÑÑ‚Ğ°Ñ€Ñ‚Ğµ
task.spawn(function()
    task.wait(1)
    ApplySpeed()
end)

print("âœ… Ğ¡ĞºÑ€Ğ¸Ğ¿Ñ‚ v2 Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½. Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ: F=Fly, G=Speed, H=Health, T=Teleport (Ğ½Ğ° Ğ¸Ğ³Ñ€Ğ¾ĞºĞ° Ğ¿Ğ¾Ğ´ Ğ¿Ñ€Ğ¸Ñ†ĞµĞ»Ğ¾Ğ¼)")
