--[[
    âš¡ ÐœÐ•ÐÐ® + Ð’Ð¡Ð• Ð¤Ð£ÐÐšÐ¦Ð˜Ð˜ âš¡
    - ESP (TeamCheck)
    - Legit Fly (F)
    - Legit Speed (G)
    - Health Boost (H)
    - Teleport to Enemy (T)
    
    ÐœÐµÐ½ÑŽ: Drawing (Ð·ÐµÐ»Ñ‘Ð½Ñ‹Ð¹ ÐºÐ²Ð°Ð´Ñ€Ð°Ñ‚ = Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¾)
    ÐÐ°Ð¶Ð¼Ð¸ Ð½Ð° Ñ‡ÐµÐºÐ±Ð¾ÐºÑ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑŽ.
]]

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = (gethui and gethui()) or game:GetService("CoreGui")

if syn and syn.protect_gui then syn.protect_gui(CoreGui) elseif protect_gui then protect_gui(CoreGui) end

local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- ========== ÐÐÐ¡Ð¢Ð ÐžÐ™ÐšÐ˜ ==========
local Settings = {
    ESP_Enabled = true,
    TeamCheck = true,          -- Ð½Ðµ Ð¿Ð¾Ð´ÑÐ²ÐµÑ‡Ð¸Ð²Ð°Ñ‚ÑŒ Ñ‚Ð¸Ð¼Ð¼ÐµÐ¹Ñ‚Ð¾Ð²

    Fly_Enabled = false,
    Fly_Speed = 50,
    Fly_Key = Enum.KeyCode.F,

    Speed_Enabled = false,
    Speed_Value = 32,
    Speed_Key = Enum.KeyCode.G,

    Health_Enabled = false,
    Health_Target = 9999,
    Health_Key = Enum.KeyCode.H,

    Teleport_Enabled = true,   -- Ð²ÑÐµÐ³Ð´Ð° Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ Ð¿Ð¾ ÐºÐ»Ð°Ð²Ð¸ÑˆÐµ
    Teleport_Key = Enum.KeyCode.T,
}

-- ========== ESP ==========
local ESP_Folder = Instance.new("Folder")
ESP_Folder.Name = "ESP_Container"
ESP_Folder.Parent = CoreGui

local function IsEnemy(player)
    if player == LocalPlayer then return false end
    if Settings.TeamCheck then
        if not player.Team or not LocalPlayer.Team then return true end
        return player.Team ~= LocalPlayer.Team
    end
    return true
end

-- ========== FLY (ÑÐºÑ€Ñ‹Ñ‚Ð½Ñ‹Ð¹) ==========
local flyBodyVelocity, flyBodyGyro, flyConnection

local function EnableFly()
    local char = LocalPlayer.Character
    if not char then return end
    local root = char:FindFirstChild("HumanoidRootPart")
    local hum = char:FindFirstChild("Humanoid")
    if not root or not hum then return end

    hum.PlatformStand = true

    flyBodyVelocity = Instance.new("BodyVelocity")
    flyBodyVelocity.MaxForce = Vector3.new(4000, 4000, 4000)
    flyBodyVelocity.Velocity = Vector3.new(0, 0, 0)
    flyBodyVelocity.Parent = root

    flyBodyGyro = Instance.new("BodyGyro")
    flyBodyGyro.MaxTorque = Vector3.new(4000, 4000, 4000)
    flyBodyGyro.P = 1000
    flyBodyGyro.D = 200
    flyBodyGyro.CFrame = root.CFrame
    flyBodyGyro.Parent = root

    Settings.Fly_Enabled = true
end

local function DisableFly()
    Settings.Fly_Enabled = false
    if flyBodyVelocity then flyBodyVelocity:Destroy() flyBodyVelocity = nil end
    if flyBodyGyro then flyBodyGyro:Destroy() flyBodyGyro = nil end
    local char = LocalPlayer.Character
    if char then
        local hum = char:FindFirstChild("Humanoid")
        if hum then hum.PlatformStand = false end
    end
end

local function ToggleFly()
    if Settings.Fly_Enabled then DisableFly() else EnableFly() end
end

-- Ð¦Ð¸ÐºÐ» Ð¿Ð¾Ð»Ñ‘Ñ‚Ð°
flyConnection = RunService.Heartbeat:Connect(function()
    if Settings.Fly_Enabled and LocalPlayer.Character then
        local root = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if root and flyBodyVelocity and flyBodyGyro then
            local move = Vector3.new()
            if UserInputService:IsKeyDown(Enum.KeyCode.W) then
                move = move + Camera.CFrame.LookVector
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.S) then
                move = move - Camera.CFrame.LookVector
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.A) then
                move = move - Camera.CFrame.RightVector
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.D) then
                move = move + Camera.CFrame.RightVector
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.Space) then
                move = move + Vector3.new(0, 1, 0)
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.LeftControl) then
                move = move - Vector3.new(0, 1, 0)
            end
            if move.Magnitude > 0 then
                move = move.Unit * Settings.Fly_Speed
            end
            flyBodyVelocity.Velocity = move
            flyBodyGyro.CFrame = CFrame.lookAt(root.Position, root.Position + Camera.CFrame.LookVector)
        end
    end
end)

-- ========== LEGIT SPEED ==========
local function ApplySpeed()
    local char = LocalPlayer.Character
    if not char then return end
    local hum = char:FindFirstChild("Humanoid")
    if hum then
        hum.WalkSpeed = Settings.Speed_Enabled and Settings.Speed_Value or 16
    end
end

local function ToggleSpeed()
    Settings.Speed_Enabled = not Settings.Speed_Enabled
    ApplySpeed()
end

-- ========== HEALTH BOOST ==========
local healthConnection
local function ApplyHealth()
    if not Settings.Health_Enabled then
        if healthConnection then healthConnection:Disconnect() healthConnection = nil end
        return
    end
    if healthConnection then return end
    healthConnection = RunService.Heartbeat:Connect(function()
        local char = LocalPlayer.Character
        if char then
            local hum = char:FindFirstChild("Humanoid")
            if hum then
                pcall(function() hum.Health = Settings.Health_Target end)
            end
        end
    end)
end

local function ToggleHealth()
    Settings.Health_Enabled = not Settings.Health_Enabled
    ApplyHealth()
end

-- ========== TELEPORT TO ENEMY ==========
local function TeleportToEnemy()
    if not Settings.Teleport_Enabled then return end
    local myChar = LocalPlayer.Character
    if not myChar then return end
    local myRoot = myChar:FindFirstChild("HumanoidRootPart")
    if not myRoot then return end

    -- Ð˜Ñ‰ÐµÐ¼ Ð±Ð»Ð¸Ð¶Ð°Ð¹ÑˆÐµÐ³Ð¾ Ð²Ñ€Ð°Ð³Ð° (Ð¶Ð¸Ð²Ð¾Ð³Ð¾, Ð²Ð¸Ð´Ð¸Ð¼Ð¾Ð³Ð¾ Ð½Ð° ÑÐºÑ€Ð°Ð½Ðµ, Ð² Ð¿Ñ€ÐµÐ´ÐµÐ»Ð°Ñ… FOV 200)
    local mousePos = UserInputService:GetMouseLocation()
    local closestDist = 200
    local target = nil
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and IsEnemy(player) then
            local char = player.Character
            if char then
                local hum = char:FindFirstChild("Humanoid")
                if hum and hum.Health > 0 then
                    local targetPart = char:FindFirstChild("HumanoidRootPart") or char:FindFirstChild("Torso") or char:FindFirstChild("UpperTorso") or char:FindFirstChild("Head")
                    if targetPart then
                        local vec, onScreen = Camera:WorldToViewportPoint(targetPart.Position)
                        if onScreen then
                            local dist = (Vector2.new(vec.X, vec.Y) - mousePos).Magnitude
                            if dist < closestDist then
                                closestDist = dist
                                target = player
                            end
                        end
                    end
                end
            end
        end
    end

    if target then
        local targetChar = target.Character
        local targetRoot = targetChar and (targetChar:FindFirstChild("HumanoidRootPart") or targetChar:FindFirstChild("Torso") or targetChar:FindFirstChild("UpperTorso"))
        if targetRoot then
            -- Ð¢ÐµÐ»ÐµÐ¿Ð¾Ñ€Ñ‚Ð¸Ñ€ÑƒÐµÐ¼ÑÑ Ð½Ð°Ð´ Ð³Ð¾Ð»Ð¾Ð²Ð¾Ð¹ Ñ†ÐµÐ»Ð¸ (Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÑƒÐ¿Ð°ÑÑ‚ÑŒ Ð½Ð° Ð½ÐµÐ³Ð¾)
            local teleportPos = targetRoot.Position + Vector3.new(0, 15, 0)
            myRoot.CFrame = CFrame.new(teleportPos)
            print("ðŸ”„ Ð¢ÐµÐ»ÐµÐ¿Ð¾Ñ€Ñ‚ Ðº " .. target.Name)
        end
    else
        print("âš ï¸ ÐÐµÑ‚ Ñ†ÐµÐ»Ð¸ Ð² Ñ€Ð°Ð´Ð¸ÑƒÑÐµ 200px")
    end
end

-- ========== Ð£ÐŸÐ ÐÐ’Ð›Ð•ÐÐ˜Ð• ÐšÐ›ÐÐ’Ð˜Ð¨ÐÐœÐ˜ ==========
UserInputService.InputBegan:Connect(function(input, gp)
    if gp then return end
    if input.KeyCode == Settings.Fly_Key then
        ToggleFly()
    elseif input.KeyCode == Settings.Speed_Key then
        ToggleSpeed()
    elseif input.KeyCode == Settings.Health_Key then
        ToggleHealth()
    elseif input.KeyCode == Settings.Teleport_Key then
        TeleportToEnemy()
    end
end)

-- Ð¡Ð±Ñ€Ð¾Ñ Ð¿Ñ€Ð¸ Ñ€ÐµÑÐ¿Ð°Ð²Ð½Ðµ
LocalPlayer.CharacterAdded:Connect(function()
    if Settings.Fly_Enabled then DisableFly() end
    ApplySpeed()
    ApplyHealth()
end)

-- ========== ESP (Ð¦Ð˜ÐšÐ›) ==========
RunService.RenderStepped:Connect(function()
    -- ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° ÑÑ‚Ð°Ñ€Ñ‹Ñ… Ñ€Ð°Ð¼Ð¾Ðº
    for _, child in pairs(ESP_Folder:GetChildren()) do
        child:Destroy()
    end

    if Settings.ESP_Enabled then
        for _, player in pairs(Players:GetPlayers()) do
            if IsEnemy(player) then
                local char = player.Character
                if char then
                    local hum = char:FindFirstChild("Humanoid")
                    if hum and hum.Health > 0 then
                        for _, part in pairs(char:GetDescendants()) do
                            if part:IsA("BasePart") and part.Transparency < 1 then
                                local box = Instance.new("BoxHandleAdornment")
                                box.Name = part.Name
                                box.Adornee = part
                                box.AlwaysOnTop = true
                                box.ZIndex = 10
                                box.Size = part.Size * 1.05
                                box.Transparency = 0.3
                                box.Color = BrickColor.new("Bright yellow")
                                box.Parent = ESP_Folder
                            end
                        end
                    end
                end
            end
        end
    end
end)

-- ========== ÐœÐ•ÐÐ® (DRAWING) ==========
local function CreateMenu()
    -- Ð¤Ð¾Ð½
    local bg = Drawing.new("Square")
    bg.Visible = true
    bg.Color = Color3.fromRGB(30, 30, 40)
    bg.Transparency = 0.9
    bg.Size = Vector2.new(280, 240)
    bg.Position = Vector2.new(50, 50)
    bg.Filled = true
    bg.ZIndex = 999

    local title = Drawing.new("Text")
    title.Visible = true
    title.Color = Color3.fromRGB(255, 255, 0)
    title.Position = Vector2.new(60, 55)
    title.Text = "âš¡ ULTIMATE MENU"
    title.Size = 18
    title.ZIndex = 1000

    local closeBtn = Drawing.new("Text")
    closeBtn.Visible = true
    closeBtn.Color = Color3.new(1,0,0)
    closeBtn.Position = Vector2.new(310, 55)
    closeBtn.Text = "X"
    closeBtn.Size = 18
    closeBtn.ZIndex = 1000

    -- Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ñ‡ÐµÐºÐ±Ð¾ÐºÑÐ°
    local checkboxes = {}
    local yPos = 85
    local function AddCheckbox(text, keyName, getter, setter)
        local box = Drawing.new("Square")
        box.Visible = true
        box.Color = getter() and Color3.fromRGB(0,255,0) or Color3.fromRGB(80,80,80)
        box.Size = Vector2.new(12,12)
        box.Position = Vector2.new(60, yPos)
        box.Filled = true
        box.ZIndex = 1000

        local lbl = Drawing.new("Text")
        lbl.Visible = true
        lbl.Color = Color3.new(1,1,1)
        lbl.Position = Vector2.new(80, yPos-2)
        lbl.Text = text .. " [" .. keyName .. "]"
        lbl.Size = 14
        lbl.ZIndex = 1000

        table.insert(checkboxes, {box=box, lbl=lbl, y=yPos, get=getter, set=setter})
        yPos = yPos + 25
    end

    AddCheckbox("ESP (TeamCheck)", "", 
        function() return Settings.ESP_Enabled end,
        function(v) Settings.ESP_Enabled = v end)

    AddCheckbox("Legit Fly", "F",
        function() return Settings.Fly_Enabled end,
        function(v) 
            if v then EnableFly() else DisableFly() end
        end)

    AddCheckbox("Legit Speed", "G",
        function() return Settings.Speed_Enabled end,
        function(v) 
            Settings.Speed_Enabled = v
            ApplySpeed()
        end)

    AddCheckbox("Health Boost", "H",
        function() return Settings.Health_Enabled end,
        function(v) 
            Settings.Health_Enabled = v
            ApplyHealth()
        end)

    -- Ð¢ÐµÐ»ÐµÐ¿Ð¾Ñ€Ñ‚ Ð²ÑÐµÐ³Ð´Ð° Ð°ÐºÑ‚Ð¸Ð²ÐµÐ½ Ð¿Ð¾ ÐºÐ»Ð°Ð²Ð¸ÑˆÐµ T
    local tpText = Drawing.new("Text")
    tpText.Visible = true
    tpText.Color = Color3.new(1,1,1)
    tpText.Position = Vector2.new(60, yPos)
    tpText.Text = "Teleport [T]"
    tpText.Size = 14
    tpText.ZIndex = 1000

    -- ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° ÐºÐ»Ð¸ÐºÐ¾Ð² Ð¼Ñ‹ÑˆÐ¸
    UserInputService.InputBegan:Connect(function(input, gp)
        if gp then return end
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            local m = UserInputService:GetMouseLocation()
            -- ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÐºÐ»Ð¸Ðº Ð¿Ð¾ Ñ‡ÐµÐºÐ±Ð¾ÐºÑÐ°Ð¼
            for _, cb in ipairs(checkboxes) do
                if m.X >= 50 and m.X <= 350 and m.Y >= cb.y-6 and m.Y <= cb.y+6 then
                    if m.X >= 60 and m.X <= 72 then
                        local new = not cb.get()
                        cb.set(new)
                        cb.box.Color = new and Color3.fromRGB(0,255,0) or Color3.fromRGB(80,80,80)
                    end
                end
            end
            -- ÐšÐ»Ð¸Ðº Ð¿Ð¾ ÐºÑ€ÐµÑÑ‚Ð¸ÐºÑƒ
            if m.X >= 310 and m.X <= 330 and m.Y >= 55 and m.Y <= 73 then
                bg.Visible = false
                title.Visible = false
                closeBtn.Visible = false
                tpText.Visible = false
                for _, cb in ipairs(checkboxes) do
                    cb.box.Visible = false
                    cb.lbl.Visible = false
                end
            end
        end
    end)
end

CreateMenu()
ApplySpeed()
print("âœ… ÐœÐµÐ½ÑŽ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ð¾. Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ: ÐºÐ»Ð¸ÐºÐ°Ð¹ Ð¿Ð¾ Ñ‡ÐµÐºÐ±Ð¾ÐºÑÐ°Ð¼, ÐºÐ»Ð°Ð²Ð¸ÑˆÐ¸ F/G/H/T.")
