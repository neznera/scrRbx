--[[
    РАСШИРЕННЫЙ ПОИСК ОБЪЕКТОВ РЯДОМ (без ошибок)
    - Нажми T, чтобы увидеть ВСЕ объекты в радиусе 20 студий.
    - Работает с BasePart и Model (даже без PrimaryPart).
]]

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer

local SEARCH_RADIUS = 20
local KEY = Enum.KeyCode.T

local function FindNearbyObjects()
    local character = LocalPlayer.Character
    if not character then
        print("❌ Персонаж не найден")
        return
    end

    local rootPart = character:FindFirstChild("HumanoidRootPart") or character:FindFirstChild("Torso")
    if not rootPart then
        print("❌ Корневая часть не найдена")
        return
    end

    local center = rootPart.Position
    local found = {}

    -- Перебираем все объекты в workspace (игнорируем части игрока)
    for _, obj in pairs(workspace:GetDescendants()) do
        -- Пытаемся получить позицию объекта
        local pos = nil

        if obj:IsA("BasePart") then
            pos = obj.Position
        elseif obj:IsA("Model") then
            -- Если есть PrimaryPart, используем его позицию
            if obj.PrimaryPart then
                pos = obj.PrimaryPart.Position
            else
                -- Иначе пробуем получить ограничивающую рамку модели
                local success, cframe = pcall(function()
                    return obj:GetBoundingBox()
                end)
                if success and cframe then
                    pos = cframe.Position
                end
            end
        end

        -- Если удалось получить позицию и объект не принадлежит персонажу
        if pos and obj:IsDescendantOf(character) == false then
            local dist = (pos - center).Magnitude
            if dist <= SEARCH_RADIUS then
                table.insert(found, {
                    Name = obj.Name,
                    Class = obj.ClassName,
                    Path = obj:GetFullName(),
                    Distance = dist,
                })
            end
        end
    end

    -- Вывод результатов
    print("\n=== ОБЪЕКТЫ РЯДОМ (радиус " .. SEARCH_RADIUS .. " stud) ===")
    if #found == 0 then
        print("Ничего не найдено")
    else
        -- Сортируем по расстоянию
        table.sort(found, function(a, b) return a.Distance < b.Distance end)
        for i, item in ipairs(found) do
            print(string.format("%d. %s (%s) — %.1f stud", i, item.Name, item.Class, item.Distance))
            print("   Путь: " .. item.Path)
        end
    end
    print("=====================================\n")
end

UserInputService.InputBegan:Connect(function(input, gp)
    if gp then return end
    if input.KeyCode == KEY then
        FindNearbyObjects()
    end
end)

print("✅ Рас22 сканер загружен. Нажми T для поиска объектов рядом.")
